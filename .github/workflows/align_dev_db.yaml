name: sync_dev_db

on:
  workflow_dispatch: # Permette di avviare lo script manualmente da GitHub UI
  # schedule:
  #   - cron: '0 2 * * *' # De-commenta questo blocco per eseguirlo ogni notte alle 2:00 UTC

jobs:
  sync-database:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Scegli la tua versione di Python

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install psycopg2-binary # Usiamo la versione binary per evitare errori di compilazione

      - name: Run sync script
        env:
          # Qui passiamo i Secret di GitHub come variabili d'ambiente allo script Python
          SUPABASE_PASSWORD_PROD: ${{ secrets.SUPABASE_PASSWORD_PROD }}
          SUPABASE_PASSWORD_DEV: ${{ secrets.SUPABASE_PASSWORD_DEV }}
        run: python align_dev_db.py # SOSTITUISCI con il nome reale del tuo file
